# Jenkins çš„ CI/CD ä¹‹æ—…ï¼ˆ1ï¼‰â€”â€” æ¦‚è¿°ä¸éƒ¨ç½²é…ç½®

## æ–‡æ¡£è¯´æ˜

- OS ç‰ˆæœ¬ï¼šRed Hat Enterprise Linux release 9.0 (Plow)
- Java ç‰ˆæœ¬ä¾èµ–ï¼š[Java 17](https://www.jenkins.io/doc/book/platform-information/support-policy-java/)
- Jenkins ç‰ˆæœ¬ï¼š[jenkins-2.479.1-1.1.noarch](https://mirrors.huaweicloud.com/jenkins/redhat-stable/jenkins-2.479.1-1.1.noarch.rpm)

## æ–‡æ¡£ç›®å½•

- [Jenkins åŸºç¡€](#jenkins-åŸºç¡€)
- [Jenkins ç³»ç»Ÿç»„ä»¶](#jenkins-ç³»ç»Ÿç»„ä»¶)
- [Jenkins çš„æ’ä»¶è®¾ç½®](#jenkins-çš„æ’ä»¶è®¾ç½®)
- [Jenkins å®‰è£…ä¸é…ç½®](#jenkins-å®‰è£…ä¸é…ç½®)

## Jenkins åŸºç¡€

### Jenkins æ˜¯ä»€ä¹ˆï¼Ÿ

- Jenkins æ˜¯ä¸€ä¸ªå¼€æºçš„ã€æä¾›å‹å¥½æ“ä½œç•Œé¢çš„æŒç»­é›†æˆï¼ˆCIï¼‰å·¥å…·ï¼Œèµ·æºäº `Hudson`ï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨åœ°æ„å»º/æµ‹è¯•è½¯ä»¶é¡¹ç›®ã€ç›‘æ§å¤–éƒ¨ä»»åŠ¡çš„è¿è¡Œã€‚
- Jenkins ç”¨ Java è¯­è¨€ç¼–å†™ï¼Œå¯åœ¨ Tomcat ç­‰æµè¡Œçš„ `servlet` å®¹å™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯é€šè¿‡ Java ç¯å¢ƒç‹¬ç«‹ä½¿ç”¨ `war` åŒ…è¿è¡Œï¼Œä¹Ÿå¯é€šè¿‡å®¹å™¨åŒ–è¿è¡Œã€‚é€šå¸¸ä¸ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼ˆSCMï¼‰ã€æ„å»ºå·¥å…·ç»“åˆä½¿ç”¨ã€‚Jenkins å¯ä»¥å¾ˆå¥½åœ°æ”¯æŒå„ç§è¯­è¨€çš„é¡¹ç›®æ„å»ºï¼Œä¹Ÿå®Œå…¨å…¼å®¹ `Maven`ã€`Ant`ã€`Gradle` ç­‰å¤šç§ç¬¬ä¸‰æ–¹æ„å»ºå·¥å…·ï¼ŒåŒæ—¶è·Ÿ SVNã€Git ç­‰å¸¸ç”¨çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·æ— ç¼é›†æˆï¼Œä¹Ÿæ”¯æŒç›´æ¥å¯¹æ¥ GitHub ç­‰æºä»£ç æ‰˜ç®¡ç½‘ç«™ã€‚
- Jenkins çš„ç‰ˆæœ¬å¯åˆ†ä¸º `1.x` ä¸ `2.x`ï¼Œç›®å‰ä¸»æµå·²ä½¿ç”¨ `2.x` ç‰ˆæœ¬ã€‚åæ–‡è‹¥æœªè¯´æ˜ç‰ˆæœ¬ï¼Œå‡ä¸º `2.x`ã€‚

### Jenkins çš„ç‰¹ç‚¹

- ç”¨äºæ³›æŒ‡æ”¯æŒæµæ°´çº¿å³ä»£ç åŠå…¶ä»–ç±»ä¼¼ `Jenkinsfile` ç­‰æ–°ç‰¹æ€§çš„æ–°ç‰ˆ Jenkinsï¼Œ`DSL` æ˜¯ Jenkins 2 çš„æ ¸å¿ƒç»„ä»¶ï¼Œä½œä¸ºæ„å»ºæ¨¡å—è®©å…¶ä»–æ ¸å¿ƒçš„ç”¨æˆ·å¯¼å‘ç‰¹æ€§æˆä¸ºå¯èƒ½ã€‚
- æ”¯æŒå°†åŸæœ¬å†™åœ¨ Jenkins ä¸­çš„ä»£ç æå–åˆ°ä¸€ä¸ª Jenkinsfile æ–‡ä»¶ä¸­ï¼Œä»è€Œä»¥ä¸€ç§æ›´åŠ ç»“æ„åŒ–çš„æ–¹æ³•æ¥åˆ›å»ºå·¥ä½œæµ â€”â€” å£°æ˜å¼æµæ°´çº¿ï¼Œå®ƒæ¯”ä¼ ç»Ÿçš„è„šæœ¬å¼æµæ°´çº¿æœ‰ç€æ›´åŠ æ¸…æ™°ã€å¯é¢„æœŸçš„ç»“æ„ï¼Œä»¥åŠæ›´å¼ºå¤§çš„ DSL å…ƒç´ å’Œç»“æ„ä½“ã€‚
- å…·æœ‰ç§°ä¸º `Blue Ocean` çš„å…¨æ–°ç”¨æˆ·ç•Œé¢ï¼Œä¸ºæµæ°´çº¿çš„æ¯ä¸ªé˜¶æ®µæ·»åŠ äº†å›¾å½¢åŒ–å±•ç¤ºï¼Œèƒ½å¤Ÿæ˜¾ç¤ºæˆåŠŸ/å¤±è´¥å’Œè¿›å±•ç­‰æ ‡è¯†ï¼Œå¹¶å¯¹æ¯ä¸ªä»»åŠ¡éƒ½æä¾›äº†ç‚¹é€‰å¼æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½ã€‚
- ç”¨äºæ”¯æŒæºç æ§åˆ¶å¹³å°ï¼ˆSCMï¼‰ä¸Šå°†å¤šä¸ªä»£ç åº“èšåˆæˆ â€œç»„ç»‡â€ çš„åŠŸèƒ½ï¼Œç›®å‰å·²ç»æ”¯æŒ Github å’Œ Bitbucket å¹³å°ä¸Šçš„ â€œç»„ç»‡â€ åŠŸèƒ½ï¼Œæœªæ¥å°†ä¼šé€æ­¥æ”¯æŒå…¶ä»–çš„å¹³å°ã€‚
- ğŸ‘ å¤šåˆ†æ”¯æµæ°´çº¿ï¼šåœ¨æœ‰ç€ Jenkinsfile çš„é¡¹ç›®ä¸­ï¼Œè‹¥åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼ŒJenkins å°†è‡ªåŠ¨åŸºäºè¿™ä¸ªæ–°åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæ­¤ç±»å‹çš„é¡¹ç›®å¯åº”ç”¨äºä»»ä½• Git æˆ– SVN ä»£ç åº“ã€‚

## Jenkins ç³»ç»Ÿç»„ä»¶

- åœ¨ Jenkins 2 ä¸­ï¼ŒèŠ‚ç‚¹ï¼ˆnodeï¼‰æ˜¯ä¸€ä¸ªåŸºç¡€æ¦‚å¿µï¼Œä»£è¡¨äº†ä»»ä½•å¯ä»¥æ‰§è¡Œ Jenkins ä»»åŠ¡çš„ç³»ç»Ÿã€‚
- èŠ‚ç‚¹ä¸­åŒ…å«ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰å’Œä»£ç†èŠ‚ç‚¹ï¼ˆagentï¼‰ä¸¤ç§ç±»å‹ï¼Œä½†ä¸»èŠ‚ç‚¹ä¸€èˆ¬ç”¨äºå®Œæˆä»»åŠ¡åˆ†é…ç­‰ç®¡ç†åŠŸèƒ½ï¼Œè€Œä»£ç†èŠ‚ç‚¹æ‰ä¼šæ‰§è¡Œå„ç±»å…·ä½“çš„ä»»åŠ¡ã€‚
  - ä¸»èŠ‚ç‚¹ï¼šJenkins çš„ä¸€ä¸ªéƒ¨ç½²å®ä¾‹çš„æ ¸å¿ƒæ§åˆ¶ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿå®Œå…¨è®¿é—®æ‰€æœ‰ Jenkins é…ç½®çš„é€‰é¡¹å’Œä»»åŠ¡ï¼ˆjobï¼‰åˆ—è¡¨ï¼Œè€Œä¸”ï¼Œè‹¥ä¸å­˜åœ¨å…¶ä»–ä»£ç†èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹ä¹Ÿæ˜¯é»˜è®¤çš„ä»»åŠ¡æ‰§è¡ŒèŠ‚ç‚¹ã€‚
  - ä»£ç†èŠ‚ç‚¹ï¼šåœ¨æ—©å…ˆç‰ˆæœ¬çš„ Jenkins ä¸­ï¼Œä»£ç†èŠ‚ç‚¹è¢«ç§°ä¸ºä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ï¼Œå®ƒä»£è¡¨ç€æ‰€æœ‰çš„éä¸»èŠ‚ç‚¹ã€‚
    - è¿™ç±»èŠ‚ç‚¹ç”±ä¸»èŠ‚ç‚¹ç®¡ç†ï¼ŒæŒ‰éœ€åˆ†é…æˆ–æŒ‡å®šæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ï¼Œå¦‚ï¼Œä¸åŒçš„æ„å»ºä»»åŠ¡æˆ–æµ‹è¯•ä»»åŠ¡ç­‰ã€‚
    - è„šæœ¬å¼æµæ°´çº¿ä¸­ï¼ŒèŠ‚ç‚¹ç‰¹æŒ‡ä¸€ä¸ªè¿è¡Œä»£ç†èŠ‚ç‚¹çš„ç³»ç»Ÿï¼Œè€Œåœ¨å£°æ˜å¼æµæ°´çº¿ä¸­ï¼Œå®ƒåˆ™æ˜¯åˆ†é…çš„ä¸€ä¸ªæ¥ä½œä¸ºä»£ç†èŠ‚ç‚¹çš„ç‰¹å®šèŠ‚ç‚¹ã€‚
  - æ‰§è¡Œå™¨ï¼ˆexecutorï¼‰ï¼šç®€å•æ¥è¯´ï¼Œexecutor åªæ˜¯èŠ‚ç‚¹æˆ–ä»£ç†èŠ‚ç‚¹ç”¨äºæ‰§è¡Œä»»åŠ¡çš„ä¸€ä¸ªæ§½ä½ï¼ˆslotï¼‰ã€‚
    - executor çš„æ•°é‡å®šä¹‰äº†è¯¥èŠ‚ç‚¹å¯ä»¥æ‰§è¡Œçš„å¹¶å‘ä»»åŠ¡é‡ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¯ä»¥æœ‰ä»»åŠ¡æ•°é‡çš„æ§½ä½ï¼Œä½†ä¹Ÿå…è®¸ç®¡ç†å‘˜æŒ‰èŠ‚ç‚¹èµ„æºå®šä¹‰åˆé€‚çš„æ•°é‡ã€‚
    - åœ¨ä¸»èŠ‚ç‚¹å°†ä»»åŠ¡åˆ†é…ç»™ç‰¹å®šèŠ‚ç‚¹æ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šå¿…é¡»æœ‰å¯ç”¨çš„ executor æ¥ç«‹å³æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦åˆ™ï¼Œåªèƒ½ç­‰åˆ°æœ‰ç©ºé—²æ§½ä½å¯ç”¨ã€‚

## Jenkins çš„æ’ä»¶è®¾ç½®

- Jenkins æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºå…·æœ‰ä¼—å¤šçš„ **æ’ä»¶**ï¼ˆpluginï¼‰ï¼Œå®é™…å·¥ä½œçš„æ˜¯æ’ä»¶ã€‚
- Jenkins ä½¿ç”¨æ’ä»¶çš„æºä½äº [jenkins.io](https://updates.jenkins.io/update-center.json) å®˜æ–¹ç«™ç‚¹ï¼Œä¸‹è½½æ›´æ–°é€Ÿåº¦å¾ˆæ…¢ï¼Œæ—¶å¸¸ç”±äºè¿æ¥è¶…æ—¶é—®é¢˜è€Œå¯¼è‡´æ’ä»¶å®‰è£…å¤±è´¥ï¼Œå› æ­¤ï¼Œå¯æ›´æ¢ä¸ºå›½å†…çš„æ’ä»¶æºã€‚
- Jenkins æ›´æ¢æ’ä»¶æºï¼š
  - `Dashboard` > `Manage Jenkins` > `Plugins` > `Advanced settings`
  - [åä¸ºäº‘çš„æ’ä»¶æº](https://mirrors.huaweicloud.com/jenkins/updates/update-center.json)ï¼š

    ![jenkins-plugins-repo.jpg](images/jenkins-plugins-repo.png)

    > æ³¨æ„ï¼šæ¸…åä¸é˜¿é‡Œäº‘çš„æ’ä»¶æºæ˜¯ Jenkins å®˜æ–¹çš„é•œåƒåŒæ­¥ï¼Œåœ¨è¿™ä¸¤ä¸ªæºä¸­å·²ä¸å­˜åœ¨ updates ç›®å½•è€Œæ— æ³•å†åŒæ­¥ï¼

## Jenkins å®‰è£…ä¸é…ç½®

- Jenkins å…·æœ‰ä¸¤ç§ä¸åŒçš„è½¯ä»¶å‘è¡Œå‘¨æœŸï¼š
  - é•¿æœŸç¨³å®šç‰ˆï¼ˆ`LTS`ï¼‰ï¼šæ¯12å‘¨æ›´æ–°ä¸€æ¬¡ï¼Œæ¯4å‘¨å‘å¸ƒ bug ä¿®å¤ä¸å®‰å…¨è¡¥ä¸åŠ å›ºã€‚
  - æ¯å‘¨æ›´æ–°ç‰ˆï¼šæ¯å‘¨æ›´æ–°ä¸€æ¬¡ä»¥è·å¾—è½¯ä»¶çš„æœ€æ–°ç‰¹æ€§
- å¦‚å‰æ‰€è¿°ï¼ŒJenkins å¯è·¨å¹³å°åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¸Šå®‰è£…è¿è¡Œï¼Œå³å¯ä»¥ä»¥ `war` åŒ…çš„å½¢å¼ç›´æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡å„ç±»è½¯ä»¶åŒ…ï¼ˆrpm æˆ– debï¼‰å®Œæˆå®‰è£…ï¼Œä¹Ÿå¯ä»¥ä»¥å®¹å™¨é•œåƒçš„æ–¹å¼åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­é€šè¿‡å®¹å™¨æˆ– pod çš„æ–¹å¼è¿è¡Œç­‰ã€‚å…·ä½“è¯·å‚è€ƒ [Download and deploy](https://www.jenkins.io/download/#download-and-deploy)ã€‚
- æ­¤æ¬¡éƒ¨ç½²ä½¿ç”¨é•¿æœŸç¨³å®šç‰ˆçš„ [RPM æ–¹å¼å®‰è£…](https://www.jenkins.io/doc/book/installing/linux/#red-hat-centos)ã€‚å‚è€ƒ [redhat-stable](https://pkg.jenkins.io/redhat-stable/) çš„æç¤ºï¼Œå¯ä¸‹è½½ `2.479.1 (October 2024) åŠä»¥ä¸Šçš„ç‰ˆæœ¬`ã€‚å› æ­¤ï¼Œç¬”è€…ç¯å¢ƒä¸­ä½¿ç”¨ `2.479.1` è½¯ä»¶åŒ…ï¼ˆä¾èµ– Java 17 æˆ– Java 21ï¼‰ã€‚
- è½¯ä»¶åŒ…é»˜è®¤ä» [Jenkins å®˜ç½‘](https://pkg.jenkins.io/) ä¸‹è½½ã€‚ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒï¼Œå¯ä»å›½å†…é•œåƒç‚¹ï¼ˆåŒ…æ‹¬ [é˜¿é‡Œäº‘](https://mirrors.aliyun.com/jenkins/?spm=a2c6h.13651104.d-5065.1.577cdb0ewKFra5) ä¸ [åä¸ºäº‘](https://mirrors.huaweicloud.com/jenkins/) æå‰ä¸‹è½½ã€‚å†æ ¹æ®ä»¥ä¸‹æ­¥éª¤å®Œæˆå®‰è£…ï¼š
  
  ```bash
  [devops@workstation ~]$ sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
  # å¯é€‰æ­¥éª¤ï¼šè‹¥æå‰ä¸‹è½½ jenkins è½¯ä»¶åŒ…ï¼Œæ­¤æ­¥å¯ä¸åšé…ç½®ã€‚
  [devops@workstation ~]$ sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key
  [devops@workstation ~]$ sudo yum upgrade
  # å¯é€‰æ­¥éª¤ï¼šAdd required dependencies for the jenkins package
  [devops@workstation ~]$ wget http://content.example.com/jenkins-ci-plt/jenkins-2.479.1-1.1.noarch.rpm
  # è½¯ä»¶åŒ…æå‰ä¸‹è½½å¹¶å·²åŒæ­¥è‡³å†…éƒ¨å…±äº«ç«™ç‚¹ï¼Œæ–¹ä¾¿èŠ‚ç‚¹é—´å…±äº«ã€‚
  [devops@workstation ~]$ sudo yum install fontconfig java-21-openjdk
  [devops@workstation ~]$ sudo yum install -y jenkins-2.479.1-1.1.noarch
  [devops@workstation ~]$ sudo systemctl daemon-reload
  ```

  æ ¹æ®ä»¥ä¸Šæ­¥éª¤å³å¯å®ŒæˆèŠ‚ç‚¹ä¸ŠåŸºäº RPM æ–¹å¼çš„ Jenkins å®‰è£…éƒ¨ç½²ã€‚

