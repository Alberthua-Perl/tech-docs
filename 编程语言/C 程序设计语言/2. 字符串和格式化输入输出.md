# 2. 字符串和格式化输入/输出

## 文档目录
- [2. 字符串和格式化输入/输出](#2-字符串和格式化输入输出)
  - [文档目录](#文档目录)
  - [文档说明](#文档说明)
  - [1. 字符串简介](#1-字符串简介)
  - [2. 常量与 C 预处理器](#2-常量与-c-预处理器)
  - [3. 研究和利用 printf() 和 scanf()](#3-研究和利用-printf-和-scanf)

## 文档说明

此文档作为重要知识点的学习记录，如需查看完整内容请翻阅《C Primer Plus（第六版）中文版》原书。

## 1. 字符串简介

- C 语言没有专门的数据类型用于存储字符串（character string），字符串被储存于 `char` 类型的数组（array）中，由连续的存储单元组成。
- C 语言中每个字符串必须以 `\0` 空字符（null character）结束，因此储存字符串的数组容量比实际储存的字符数量多 1，最后一个字符留给空字符。

  > 数组：同类型数据元素的有序序列，是一个连续的多个存储单元。

- `scanf()` 函数只读取字符串中第一个空白（空格、制表符或换行符）前的字符串，之后的字符串不再读取。请使用 `fgets()` 函数读取一般字符串。

## 2. 常量与 C 预处理器

- 符号常量的声明方法：
  - `#define` 预处理器
  - `const` 修饰符
  - `enum` 枚举

  > 注意：以下主要讨论前两种方法，枚举功能在后续章节中介绍。

- 使用 `#define` 预处理器声明符号常量，其中在程序编译时直接替换常量的方式称为编译时代入法（compile-time substitution），而通过这种方法完成替换的常量称为明显常量（manifest constant）。
- `#define` 声明的符号常量是一种替换机制而不是 C 语句，因此无需分号结束。常规的变量声明使用常量赋值是一种赋值方式不是替换机制，变量的值非常容易被再次更改。符号常量的声明通常使用大写字母与常规的变量声明以作区分。
- `#define` 声明符号常量的示例：

  ```c
  #define Pi 3.14159  // 明显常量声明
  #define BEEP '\a'  // 字符常量声明
  #define TEE 'T'
  #define ESC '\033'
  #define OOPS "Now you have done it!"  // 字符串常量声明
  ```

- `const` 修饰符示例：

  ```c
  const int MONTHS = 12;  // const 声明 MONTHS 符号常量
  ```

- 💪 系统定义的明显常量：明显常量定义于 `/usr/include/limits.h` 与 `/usr/lib/gcc/x86_64-redhat-linux/8/include/float.h` 头文件中。

  > 注意：以上两个头文件分别位于笔者所使用的环境中，具体的符号常量定义请查看源文件。

## 3. 研究和利用 printf() 和 scanf()

- printf() 函数说明：
  - printf() 函数使用 `%` 来标识转换说明，如需表示 % 本身，需使用两个 % 表示。
  - 🏷 printf() 函数转换说明的修饰符与标志说明，如 `%05.3d` 表示整形值字段宽度为 5（修饰符），最小精度位数为 3（修饰符），若前导 0（标志）与最小精度同时出现，前导 0 将忽略。
  - ✨ 使用 printf() 函数的不同转换说明可以将一个数字解释成为不同的值，因此需确认当前系统上支持的各数据类型的大小（`sizeof` 操作符），不同的数据类型转换之间可能需要通过截断处理，此处可参考程序代码 `intconv.c`。

    > 注意：2 的补码方式用于有符号（signed）与无符号（unsigned）数值间的转换，而数值的截断处理用于表示大范围数值向小范围数值的转换（二进制数值的截断）。

  - printf() 函数打印较长的字符串时，空白字符（空格、制表符与换行符）若不用于分隔元素，C 将忽略它们。因此，可在多行放置一个语句，只要在元素之间放置换行符即可。不过，不能在引号括起来的字符串中间断行。关于打印较长字符串的示例可参考程序代码 `longstrg.c`。
- scanf() 函数说明：
  - 💥 由于笔者环境中使用的 GCC 版本为 `8.5.0 20210514`，与原书中 P94-95 得出不同的结论。
  - scanf() 函数使用空白（空格、制表符或换行符）把输入分成多个字段，在依次把转换说明与字段匹配时跳过空白。每个输入项之间输入至少一个空格、制表符或换行符，可在一行或多行输入。
  - 该函数从第一个非空字符开始读取输入，若读取的内容与转换说明不匹配，则不将其赋值给变量，将跳过此转换说明的赋值，直到读取到与转换说明相匹配的值才将其赋值给变量，与原书中的描述（如果使用带多个转换说明的 scanf()，C 规定在第一个出错处停止读取输入）不相符。可参考程序代码 `ctm_input.c`，如下所示：

    ```bash
    ### 示例1 ###
    $ ./ctm_input
    Enter your age, assets and favorite pet.
    36782.348
    hello world
    36782 $0.35 hello  # 浮点数被截断为整形部分与浮点部分，而输入的字符串只显示下一个空格之前的内容。

    ### 示例2 ###
    $ ./ctm_input
    Enter your age, assets and favorite pet.
    hello_world
    0 $0.00 hello_world  # 转换说明未匹配到整型数与浮点数，跳过对变量的赋值，因此只显示输入的字符串的内容。
    ```

  - ✨ scanf() 函数支持格式化字符串中使用普通字符，如下所示：

    ```bash
    $ ./ctm_input
    Enter your age, assets and favorite pet.
    88,121  # 跳过空白（换行符）
    hualf
    88 $121.00 hualf  # 转换说明完全匹配输出

    $ ./ctm_input
    Enter your age, assets and favorite pet.
    88 , 121
    88 $0.00 ,  # 转换说明匹配到 88 后，跳过空白读取逗号作为显示的字符，浮点数不再赋值。
    ```

  - scanf() 函数返回成功读取的项数，若没有读取任何项，即返回 0。
  - 当 scanf() 函数检测到文件结尾时，会返回由 `stdio.h` 中定义的 `EOF` 值，即 `#define EOF (-1)`。
